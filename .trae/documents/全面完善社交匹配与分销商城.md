## 项目现状简要
- 后端：Spring Boot 3、MyBatis-Plus、Redis/Redisson、MinIO、Knife4j；IM 实时服务基于 Netty WebSocket/TCP（路径 `/im`）。
- 管理后台：RuoYi 多模块后端与 Vue3 前端；Web 聊天端（Vue2）、UniApp 移动端；含 WebRTC 相关页面与控制器。
- 业务模块：社交/好友/群组/消息控制器在 `im_chat_server/im-platform/.../controller`；商城与分销控制器如 `MallController`、`DistributionController`、`DistributionStatisticsController`；IM 实时在 `im_chat_server/im-server`。
- 日志：logback 已配置；测试用例较少，需补充。

## 总体目标
- 按四大领域完善：社交匹配、分销商城、系统架构、用户体验，并满足交付标准与并发性能目标（1000+）。

## 里程碑与阶段
### Phase 1：社交匹配功能完善
1. 匹配算法
- 在 `im-platform` 扩展/完善服务层（如 `MatchServiceImpl`）：
  - 兴趣标签匹配：基于用户标签倒排与相似度（Jaccard/TF-IDF），支持权重配置。
  - 地理位置筛选：经纬度（GeoHash 或 Haversine）范围过滤，距离权重并入总评分。
  - 活跃度权重：最近登录、消息频次、完成度等指标归一化计分。
- 在 `MatchController` 增加/完善接口：`/match/search`、`/match/recommend`、分页与排序参数、去重与黑名单过滤。
2. 用户资料展示与互动
- 扩充 `User`/`UserProfile` 相关实体与 VO（安全字段过滤），在 `UserController` 增加多维度展示接口（基本信息、兴趣、动态、共同好友）。
- 互动操作：关注/拉黑/举报在相应控制器与服务层统一幂等与验权。
3. 实时聊天功能
- 服务端：确认 `Netty WebSocket` 管道（`/im`）支持文本、图片、表情；新增图片消息走 MinIO 上传并返回可访问链接；表情消息以统一枚举/贴图 ID 传输。
- 客户端：在 Web（`im_chat_web/src/api/wssocket.js`）与 UniApp（`common/wssocket.js`）完善消息类型处理、重连与心跳、离线消息拉取。
4. 匹配反馈机制
- 新增实体/表如 `match_feedback`，服务与控制器 `MatchFeedbackService/Controller`：创建反馈、评分维度、追踪匹配来源；防刷保护（频控、风控规则）。

### Phase 2：分销商城功能完善
1. 商品管理后台
- 后端（`im_chat_backstage` 与 `im-platform`）：多级分类、SKU 维度、库存扣减策略（下单/支付/取消回滚），支持上下架与规格图。
- 前端（`im_chat_backstage_ui`）：商品、分类、SKU、库存管理页面与表单校验；批量导入/导出。
2. 分销佣金系统
- 多级比例配置（如 2-3 级）：新增配置表与后端配置接口；佣金结算服务（下单/支付事件触发结算）；处理自购与循环关系、上级失效等边界。
- 结算周期与提现：支持 T+N 结算，提现申请审核、打款记录；流水与资金明细表一致性校验。
3. 订单处理流程
- 订单状态机：创建、待支付、已支付、已发货、完成、退货/售后；事件通知（站内信/短信可留接口）。
- 支付：保留 iOS 内购验证（现有 `IOSReceiptVerifyUtil`），预留第三方支付扩展（参数化渠道）。
4. 分销数据统计面板
- 扩展 `DistributionStatisticsController`：总览、排行、趋势、转化漏斗；
- 前端图表：日/周/月维度筛选、导出与分享。

### Phase 3：系统架构与质量
1. API 完整性与安全
- 接口清单核对：社交、商城、分销、IM；补充鉴权（Sa-Token/自定义）、角色与数据权限、签名/防重、频率限制（Redisson/令牌桶）。
- 统一错误码与返回体；参数校验（JSR-380）；文件上传安全（MIME/大小/病毒扫描预留）。
2. 数据库与性能优化
- 索引与慢查询优化；读写分离与缓存策略（热点数据加 Redis）；分页与批量写优化，避免 N+1 查询。
- 地理与标签表结构优化；异步化重任务（消息推送、统计聚合）。
3. 日志与错误监控
- logback 分类与追踪 ID；操作审计与关键业务埋点；异常统一上报（接入 APM/告警接口可留扩展点）。
4. 自动化测试
- 后端：核心服务与控制器单元/集成测试（MockMVC、Testcontainers MySQL/Redis）；
- 前端：组件与页面单元测试（Vitest），关键流 E2E（Playwright/Cypress）。
- 覆盖率门槛：核心模块 ≥80%。

### Phase 4：用户体验与性能
- 统一 UI 设计规范：主题变量、组件规范、状态与空态一致；暗色模式兼容。
- 性能优化：路由与组件懒加载，图片压缩与占位，WebSocket 重连/退避策略；列表虚拟化与分页。
- 响应式与多设备适配：Web 与 UniApp 对齐交互，断网与弱网体验优化。
- 帮助与引导：首屏引导、任务提示、FAQ 入口；埋点观测用户路径。

### Phase 5：交付与性能达标
- 测试通过：单元/集成/E2E 全绿，关键回归用例固化。
- 代码规范：检查器与格式化钩子；安全与性能审查清单走查。
- API 文档与部署指南：补齐 Swagger/Knife4j 注解与示例；部署参数与横向扩容说明；运维脚本与告警列表。
- 并发性能：Netty 与连接池调优，Redis 与缓存命中率提升，压测报告（1000+ 并发场景下 P95/P99 指标与资源占用）。

## 详细变更清单（按模块）
- 社交匹配：`MatchController`、`MatchServiceImpl`、`UserController`、`Friend*Controller`、匹配反馈新增 `MatchFeedback*`；实体/Mapper 及 SQL 迁移。
- 聊天与消息：`im-server` WebSocket/TCP 处理器增加图片/表情类型与消息存储；前端 `wssocket.js` 与 UniApp 客户端更新。
- 商城：`Mall*Controller`、`MallProduct/MallOrder` 实体与 Mapper、SKU/库存表与服务；后台 UI 与表格表单。
- 分销：`Distribution*Controller/Service`、佣金/资金/提现实体与 Mapper、统计服务扩展；前端统计大屏。
- 架构与质量：统一异常、鉴权、限流、日志与埋点；测试工程与用例新增。

## 验收与验证
- 用例：核心流程全链路（匹配→聊天→下单→分销结算→统计展示）。
- 覆盖率：后端/前端关键模块 ≥80%；压力测试通过并生成报告。
- 文档：接口说明通过 Knife4j/Swagger 可视化；部署说明包含参数与资源建议。

## 风险与回滚
- 数据库迁移谨慎评审与备份；灰度发布与开关（Feature Toggle）；异常回滚与补偿流程（库存与佣金）。

## 时间与资源建议
- 3–5 个迭代（每迭代 2 周）：匹配/聊天 → 商城/分销 → 架构/测试 → UX/性能 → 交付与压测。
- 角色：后端×2、前端×2、测试×1、运维×1（视规模调整）。