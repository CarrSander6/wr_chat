# IM Chat å¿«é€Ÿå‚è€ƒ

## ğŸš€ å¿«é€Ÿå¯åŠ¨å‘½ä»¤

### åç«¯æœåŠ¡

```bash
# IMèŠå¤©æœåŠ¡å™¨ (ç«¯å£: 8080/8081)
cd im_chat_server
mvn clean install
mvn spring-boot:run -pl im-platform

# åå°ç®¡ç†ç³»ç»Ÿ (ç«¯å£: 8081)
cd im_chat_backstage
mvn clean install
cd ruoyi-admin && mvn spring-boot:run

# çº¢åŒ…æœåŠ¡ (ç«¯å£: 8082)
cd im-red-package
mvn clean install
mvn spring-boot:run
```

### å‰ç«¯æœåŠ¡

```bash
# Webå®¢æˆ·ç«¯ (ç«¯å£: 8082)
cd im_chat_web
npm install
npm run serve

# ç®¡ç†åå° (ç«¯å£: 8083)
cd im_chat_backstage_ui
npm install
npm run dev

# ç¾¤ç»„éŸ³è§†é¢‘
cd im-webview-group-rtc
npm install
npm run serve

# ç§èŠéŸ³è§†é¢‘
cd im-webview-private-rtc
npm install
npm run serve
```

## ğŸ”— å¸¸ç”¨URL

### åº”ç”¨è®¿é—®

| åº”ç”¨ | URL | è¯´æ˜ |
|-----|-----|------|
| Webå®¢æˆ·ç«¯ | http://localhost:8082 | èŠå¤©å®¢æˆ·ç«¯ |
| ç®¡ç†åå° | http://localhost:8083 | åå°ç®¡ç†ç•Œé¢ |
| IM APIæ–‡æ¡£ | http://localhost:8080/doc.html | Knife4j APIæ–‡æ¡£ |
| åå°APIæ–‡æ¡£ | http://localhost:8081/doc.html | SpringDoc APIæ–‡æ¡£ |

### WebSocketè¿æ¥

```javascript
// WebSocketè¿æ¥åœ°å€
ws://localhost:8081/ws?accessToken={token}
```

## ğŸ“ å¸¸ç”¨APIé€ŸæŸ¥

### ç”¨æˆ·ç›¸å…³

```bash
# ç”¨æˆ·ç™»å½•
POST /login
{
  "username": "zhangsan",
  "password": "123456"
}

# è·å–ç”¨æˆ·ä¿¡æ¯
GET /user/self

# æŸ¥æ‰¾ç”¨æˆ·
GET /user/search?name=zhangsan
```

### å¥½å‹ç›¸å…³

```bash
# å¥½å‹ç”³è¯·
POST /friend/request/apply
{
  "friendId": 10002,
  "applyInfo": "æˆ‘æ˜¯å¼ ä¸‰"
}

# åŒæ„å¥½å‹ç”³è¯·
POST /friend/request/approve
{
  "requestId": 1
}

# æŸ¥è¯¢å¥½å‹åˆ—è¡¨
GET /friend/list
```

### ç¾¤èŠç›¸å…³

```bash
# åˆ›å»ºç¾¤èŠ
POST /group/create
{
  "groupName": "æŠ€æœ¯äº¤æµç¾¤",
  "memberIds": [10002, 10003]
}

# æŸ¥è¯¢ç¾¤èŠåˆ—è¡¨
GET /group/list

# é‚€è¯·è¿›ç¾¤
POST /group/invite
{
  "groupId": 1001,
  "memberIds": [10004]
}
```

### æ¶ˆæ¯ç›¸å…³

```bash
# æ‹‰å–ç§èŠç¦»çº¿æ¶ˆæ¯
GET /message/private/pullOfflineMessage

# æ‹‰å–ç¾¤èŠç¦»çº¿æ¶ˆæ¯
GET /message/group/pullOfflineMessage

# ç§èŠæ¶ˆæ¯å·²è¯»
PUT /message/private/readed
{
  "friendId": 10002,
  "maxMessageId": 10001
}
```

## ğŸ’¬ WebSocketæ¶ˆæ¯æ ¼å¼

### å‘é€ç§èŠæ¶ˆæ¯

```json
{
  "type": "PRIVATE_MESSAGE",
  "data": {
    "receiverId": 10002,
    "content": "ä½ å¥½",
    "messageType": 1
  }
}
```

### å‘é€ç¾¤èŠæ¶ˆæ¯

```json
{
  "type": "GROUP_MESSAGE",
  "data": {
    "groupId": 1001,
    "content": "å¤§å®¶å¥½",
    "messageType": 1,
    "atUserIds": [10002]
  }
}
```

### å¿ƒè·³æ¶ˆæ¯

```json
{
  "type": "HEARTBEAT",
  "data": {}
}
```

## ğŸ”¢ å¸¸ç”¨æšä¸¾å€¼

### æ¶ˆæ¯ç±»å‹ (messageType)

| å€¼ | ç±»å‹ |
|---|------|
| 1 | æ–‡æœ¬æ¶ˆæ¯ |
| 2 | å›¾ç‰‡æ¶ˆæ¯ |
| 3 | è¯­éŸ³æ¶ˆæ¯ |
| 4 | è§†é¢‘æ¶ˆæ¯ |
| 5 | æ–‡ä»¶æ¶ˆæ¯ |
| 6 | ä½ç½®æ¶ˆæ¯ |

### ç¾¤æˆå‘˜è§’è‰²

| å€¼ | è§’è‰² |
|---|------|
| OWNER | ç¾¤ä¸» |
| MANAGER | ç®¡ç†å‘˜ |
| MEMBER | æ™®é€šæˆå‘˜ |

### çº¢åŒ…ç±»å‹

| å€¼ | ç±»å‹ |
|---|------|
| 1 | æ‹¼æ‰‹æ°”çº¢åŒ… |
| 2 | æ™®é€šçº¢åŒ… |

### é€šè¯æ¨¡å¼

| å€¼ | æ¨¡å¼ |
|---|------|
| 1 | è§†é¢‘é€šè¯ |
| 2 | è¯­éŸ³é€šè¯ |

## ğŸ—„ï¸ æ•°æ®åº“é…ç½®

### MySQLé…ç½®

```yaml
spring:
  datasource:
    url: jdbc:mysql://localhost:3306/im_chat?useUnicode=true&characterEncoding=utf-8
    username: root
    password: 123456
```

### Redisé…ç½®

```yaml
spring:
  redis:
    host: localhost
    port: 6379
    password: 
    database: 0
```

## ğŸ”‘ è®¤è¯æµç¨‹

### 1. ç™»å½•è·å–Token

```bash
POST /login
{
  "username": "zhangsan",
  "password": "123456"
}

# å“åº”
{
  "code": 200,
  "data": {
    "accessToken": "eyJhbG...",
    "refreshToken": "eyJhbG...",
    "userId": 10001
  }
}
```

### 2. ä½¿ç”¨Tokenè®¿é—®API

```bash
# HTTPè¯·æ±‚å¤´
Authorization: Bearer eyJhbG...
```

### 3. Tokenè¿‡æœŸåˆ·æ–°

```bash
PUT /refreshToken
{
  "refreshToken": "eyJhbG..."
}
```

## ğŸ› å¸¸è§é”™è¯¯ç 

| é”™è¯¯ç  | è¯´æ˜ | è§£å†³æ–¹æ¡ˆ |
|-------|------|---------|
| 401 | Tokenæ— æ•ˆæˆ–è¿‡æœŸ | é‡æ–°ç™»å½•æˆ–åˆ·æ–°Token |
| 403 | æƒé™ä¸è¶³ | æ£€æŸ¥ç”¨æˆ·æƒé™ |
| 1001 | ç”¨æˆ·ä¸å­˜åœ¨ | æ£€æŸ¥ç”¨æˆ·ID |
| 2002 | å·²ç»æ˜¯å¥½å‹ | æ— éœ€é‡å¤æ·»åŠ  |
| 3002 | ä¸æ˜¯ç¾¤æˆå‘˜ | å…ˆåŠ å…¥ç¾¤ç»„ |
| 4001 | ä½™é¢ä¸è¶³ | å……å€¼åé‡è¯• |
| 5001 | çº¢åŒ…å·²æŠ¢å®Œ | çº¢åŒ…å·²é¢†å®Œ |

## ğŸ“¦ Mavenä¾èµ–ç‰ˆæœ¬

### im_chat_server

```xml
<spring-boot.version>3.3.1</spring-boot.version>
<java.version>17</java.version>
<mybatisplus.version>3.5.7</mybatisplus.version>
<redisson.version>3.21.3</redisson.version>
```

### im_chat_backstage

```xml
<spring-boot.version>3.2.11</spring-boot.version>
<java.version>21</java.version>
<mybatis-plus.version>3.5.8</mybatis-plus.version>
<satoken.version>1.39.0</satoken.version>
```

### im-red-package

```xml
<spring-boot.version>2.6.13</spring-boot.version>
<java.version>1.8</java.version>
<mybatis-plus.version>3.5.1</mybatis-plus.version>
```

## ğŸ§ª æµ‹è¯•å‘½ä»¤

### åç«¯æµ‹è¯•

```bash
# è¿è¡Œæ‰€æœ‰æµ‹è¯•
mvn test

# è¿è¡ŒæŒ‡å®šæµ‹è¯•ç±»
mvn test -Dtest=UserServiceTest

# è·³è¿‡æµ‹è¯•æ„å»º
mvn clean install -DskipTests
```

### å‰ç«¯æµ‹è¯•

```bash
# è¿è¡Œå•å…ƒæµ‹è¯•
npm run test:unit

# è¿è¡ŒE2Eæµ‹è¯•
npm run test:e2e
```

## ğŸ”§ ç¯å¢ƒå˜é‡

### å¼€å‘ç¯å¢ƒ

```bash
# IMæœåŠ¡å™¨
export SPRING_PROFILES_ACTIVE=dev
export MYSQL_HOST=localhost
export REDIS_HOST=localhost

# å‰ç«¯
export VUE_APP_API_URL=http://localhost:8080
export VUE_APP_WS_URL=ws://localhost:8081/ws
```

### ç”Ÿäº§ç¯å¢ƒ

```bash
export SPRING_PROFILES_ACTIVE=prod
export MYSQL_HOST=prod-db-server
export REDIS_HOST=prod-redis-server
```

## ğŸ“Š æ€§èƒ½ç›‘æ§

### JVMç›‘æ§

```bash
# æŸ¥çœ‹JVMå†…å­˜ä½¿ç”¨
jmap -heap <pid>

# ç”Ÿæˆå †è½¬å‚¨
jmap -dump:format=b,file=heap.bin <pid>

# æŸ¥çœ‹çº¿ç¨‹çŠ¶æ€
jstack <pid>
```

### Spring Boot Actuator

```bash
# å¥åº·æ£€æŸ¥
GET /actuator/health

# æŸ¥çœ‹æŒ‡æ ‡
GET /actuator/metrics

# æŸ¥çœ‹æ—¥å¿—çº§åˆ«
GET /actuator/loggers
```

## ğŸ”„ Gitå·¥ä½œæµ

```bash
# å…‹éš†é¡¹ç›®
git clone https://github.com/CarrSander6/wr_chat.git

# åˆ›å»ºåŠŸèƒ½åˆ†æ”¯
git checkout -b feature/new-feature

# æäº¤ä»£ç 
git add .
git commit -m "feat: add new feature"

# æ¨é€åˆ°è¿œç¨‹
git push origin feature/new-feature

# åˆ›å»ºPull Request
```

## ğŸ—ï¸ éƒ¨ç½²æ¸…å•

### Dockeréƒ¨ç½²

```bash
# æ„å»ºé•œåƒ
docker build -t im-chat-server:latest ./im_chat_server

# è¿è¡Œå®¹å™¨
docker run -d -p 8080:8080 im-chat-server:latest

# ä½¿ç”¨docker-compose
docker-compose up -d
```

### Nginxé…ç½®

```nginx
upstream im_server {
    server localhost:8080;
}

server {
    listen 80;
    server_name im.example.com;
    
    location / {
        proxy_pass http://im_server;
        proxy_set_header Host $host;
        proxy_set_header X-Real-IP $remote_addr;
    }
    
    location /ws {
        proxy_pass http://localhost:8081;
        proxy_http_version 1.1;
        proxy_set_header Upgrade $http_upgrade;
        proxy_set_header Connection "upgrade";
    }
}
```

## ğŸ“š ç›¸å…³æ–‡æ¡£

- [é¡¹ç›®è¯´æ˜æ–‡æ¡£](./é¡¹ç›®è¯´æ˜æ–‡æ¡£.md)
- [APIæ¥å£æ–‡æ¡£](./APIæ¥å£æ–‡æ¡£.md)
- [æ–‡æ¡£ä¸­å¿ƒ](./README.md)

---

**æç¤ºï¼š** è¿™æ˜¯ä¸€ä¸ªå¿«é€Ÿå‚è€ƒæ–‡æ¡£ï¼Œè¯¦ç»†ä¿¡æ¯è¯·æŸ¥çœ‹å®Œæ•´æ–‡æ¡£ã€‚
