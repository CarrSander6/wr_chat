# 缘分匹配系统测试数据说明

## 概述

本测试数据脚本为"缘分"匹配功能提供完整的测试数据，包括30个测试用户、匹配操作记录和成功匹配对。

## 文件说明

- **test_data_match_system.sql** - 缘分匹配系统完整测试数据

## 数据内容

### 1. 测试用户 (30位)

#### 女性用户 (ID: 100-114, 共15位)
- 小雨 (ID: 100) - 北京, 24岁, 喜欢音乐、旅行、摄影
- 晓晓 (ID: 101) - 上海, 26岁, 喜欢美食、健身、阅读
- 梦琪 (ID: 102) - 广州, 23岁, 喜欢电影、音乐、购物
- 雅静 (ID: 103) - 深圳, 28岁, 喜欢瑜伽、绘画、咖啡
- 欣欣 (ID: 104) - 杭州, 25岁, 喜欢宠物、烘焙、舞蹈
- 倩倩 (ID: 105) - 成都, 27岁, 喜欢旅行、摄影、美食
- 婷婷 (ID: 106) - 武汉, 24岁, 喜欢健身、跑步、游泳
- 诗琪 (ID: 107) - 南京, 26岁, 喜欢阅读、写作、电影
- 佳佳 (ID: 108) - 西安, 25岁, 喜欢美食、探店、音乐
- 嘉嘉 (ID: 109) - 重庆, 29岁, 喜欢瑜伽、旅行、摄影
- 琳琳 (ID: 110) - 天津, 27岁, 喜欢摄影、旅行、咖啡
- 思思 (ID: 111) - 苏州, 24岁, 喜欢音乐、钢琴、电影
- 雪儿 (ID: 112) - 青岛, 26岁, 喜欢烘焙、美食、购物
- 妮妮 (ID: 113) - 大连, 28岁, 喜欢阅读、茶道、绘画
- 珊珊 (ID: 114) - 厦门, 25岁, 喜欢徒步、露营、旅行

#### 男性用户 (ID: 115-129, 共15位)
- 阿伟 (ID: 115) - 北京, 26岁, 喜欢编程、游戏、电影
- 小明 (ID: 116) - 上海, 25岁, 喜欢篮球、足球、健身
- 浩然 (ID: 117) - 广州, 28岁, 喜欢旅行、摄影、咖啡
- 子轩 (ID: 118) - 深圳, 27岁, 喜欢音乐、吉他、摇滚
- 俊杰 (ID: 119) - 杭州, 24岁, 喜欢美食、探店、旅行
- 志强 (ID: 120) - 成都, 29岁, 喜欢健身、跑步、营养
- 文博 (ID: 121) - 武汉, 26岁, 喜欢阅读、写作、历史
- 天宇 (ID: 122) - 南京, 25岁, 喜欢电影、摄影、音乐
- 瑞阳 (ID: 123) - 西安, 23岁, 喜欢游戏、电竞、动漫
- 建国 (ID: 124) - 重庆, 30岁, 喜欢摄影、旅行、美食
- 鹏飞 (ID: 125) - 天津, 27岁, 喜欢咖啡、烘焙、音乐
- 宇航 (ID: 126) - 苏州, 28岁, 喜欢登山、徒步、露营
- 凯文 (ID: 127) - 青岛, 26岁, 喜欢设计、绘画、摄影
- 嘉华 (ID: 128) - 大连, 25岁, 喜欢科技、数码、编程
- 俊豪 (ID: 129) - 厦门, 29岁, 喜欢旅行、摄影、历史

### 2. 匹配操作记录

脚本包含多个用户的匹配操作记录，模拟真实的用户行为：
- 喜欢操作 (action_type = 1)
- 不喜欢操作 (action_type = 2)

### 3. 成功匹配对 (11对)

以下用户已成功匹配（双方互相喜欢）：
1. 小雨 (100) ❤️ 阿伟 (115)
2. 小雨 (100) ❤️ 小明 (116)
3. 小雨 (100) ❤️ 子轩 (118)
4. 晓晓 (101) ❤️ 小明 (116)
5. 晓晓 (101) ❤️ 志强 (120)
6. 梦琪 (102) ❤️ 浩然 (117)
7. 梦琪 (102) ❤️ 天宇 (122)
8. 雅静 (103) ❤️ 俊杰 (119)
9. 雅静 (103) ❤️ 建国 (124)
10. 欣欣 (104) ❤️ 志强 (120)
11. 欣欣 (104) ❤️ 宇航 (126)

## 使用方法

### 1. 导入测试数据

```bash
# 方法1: 使用 MySQL 命令行
mysql -u your_username -p your_database < test_data_match_system.sql

# 方法2: 使用 source 命令
mysql -u your_username -p your_database
mysql> source /path/to/test_data_match_system.sql;
```

### 2. 登录测试账号

所有测试用户的登录信息：
- **用户名**: test_user_100 到 test_user_129
- **密码**: 123456
- **交易密码**: 888888

### 3. 验证数据

执行以下查询验证数据是否导入成功：

```sql
-- 查询测试用户数量
SELECT COUNT(*) AS test_user_count FROM im_user WHERE id >= 100;
-- 预期结果: 30

-- 查询匹配记录数量
SELECT COUNT(*) AS match_record_count FROM im_user_match_record WHERE user_id >= 100;
-- 预期结果: 约40+条记录

-- 查询成功匹配数量
SELECT COUNT(*) AS match_count FROM im_user_match WHERE user1_id >= 100 OR user2_id >= 100;
-- 预期结果: 11

-- 查询某个用户的推荐列表（以用户100为例）
SELECT u.id, u.nick_name, u.age, u.city, u.interests 
FROM im_user u 
WHERE u.id NOT IN (
    SELECT target_user_id FROM im_user_match_record WHERE user_id = 100
) 
AND u.id != 100 
AND u.status = 0 
AND u.is_banned = 0
LIMIT 10;
```

### 4. 测试场景

#### 场景1: 浏览推荐用户
1. 使用用户 test_user_105 (倩倩) 登录
2. 进入"缘分"页面
3. 应该看到推荐的用户卡片（未操作过的用户）

#### 场景2: 喜欢/不喜欢操作
1. 滑动卡片或点击按钮进行操作
2. 系统会记录操作到 im_user_match_record 表

#### 场景3: 查看匹配列表
1. 使用用户 test_user_100 (小雨) 登录
2. 点击"匹配"按钮
3. 应该看到3个匹配用户：阿伟、小明、子轩

#### 场景4: 查看历史记录
1. 点击"历史"按钮
2. 切换"喜欢"和"不喜欢"标签
3. 查看历史操作记录

## 清理测试数据

如果需要清理测试数据，执行以下SQL：

```sql
-- 清理测试数据
DELETE FROM im_user_match_record WHERE user_id >= 100 OR target_user_id >= 100;
DELETE FROM im_user_match WHERE user1_id >= 100 OR user2_id >= 100;
DELETE FROM im_user WHERE id >= 100;
```

## 注意事项

1. **数据安全**: 此脚本仅用于测试环境，请勿在生产环境使用
2. **ID冲突**: 测试用户ID从100开始，避免与现有用户冲突
3. **密码加密**: 所有密码已使用BCrypt加密，符合系统安全要求
4. **图片资源**: 头像使用占位图服务，实际使用时可替换为真实图片
5. **地理位置**: 经纬度数据为真实城市坐标，可用于测试基于位置的推荐

## 数据特点

- ✅ 用户资料完整（昵称、年龄、性别、兴趣、城市、地理位置）
- ✅ 性别比例均衡（50% 男性，50% 女性）
- ✅ 年龄分布合理（23-30岁）
- ✅ 兴趣多样化（涵盖运动、艺术、科技、旅行等）
- ✅ 地理位置分布（覆盖国内主要一二线城市）
- ✅ 登录时间分布（模拟不同活跃度）
- ✅ 匹配场景真实（单向喜欢、互相喜欢、不喜欢）

## 技术说明

### 匹配算法评分因素

根据 `MatchRecommendServiceImpl.java` 实现，匹配分数综合考虑：

1. **性别偏好** (30分): 异性匹配得分更高
2. **年龄差距** (20分): 年龄相近得分更高
3. **兴趣相似度** (20分): 共同兴趣越多得分越高
4. **活跃度** (15分): 最近登录得分更高
5. **资料完整度** (15分): 资料越完整得分越高

### API接口

- `GET /match/candidates?limit=10` - 获取推荐用户
- `POST /match/action` - 记录匹配操作
- `GET /match/history` - 获取历史记录
- `GET /match/matched` - 获取已匹配用户
- `GET /match/check` - 检查匹配状态

## 支持

如有问题或建议，请提交Issue或联系开发团队。
